package adstatic.tools;

import android.util.Log;
import com.google.gson.Gson;

import java.io.*;
import java.util.HashMap;
import java.util.Map;

public class Deserialize {


    public static VulnRetuHub DeserializeToVulnRetuHub(String data) throws Exception{
        Log.d("INFO","Start!!!");
//        File file = new File("C:\\Users\\liu\\IdeaProjects\\TestAPP\\output.txt");
//        Reader reader = new InputStreamReader(new FileInputStream(file));
//        int read;
//        byte[] data = new byte[(int) file.length()];
//        int len = 0;
//        while ((read = reader.read()) != -1) {
//            data[len++] = (byte) read;
//            if ((char) read != '\r') {
//                System.out.print((char) read);
//            }
//        }
        Log.d("INFO",data);
        Gson gson = new Gson();
        Map<String, Object> map = new HashMap<>();
        map = gson.fromJson(data, map.getClass());
        System.out.println(map.get("classify"));
        for (Map.Entry<String, Object> entry:map.entrySet()){
            Log.d("INFO",entry.getKey());
            Log.d("INFO",entry.getValue().toString());
        }
        byte[] vuln = android.util.Base64.decode(data,android.util.Base64.DEFAULT);
        ByteArrayInputStream byteArrayInputStream = new ByteArrayInputStream(vuln);
        ObjectInputStream ois = new ObjectInputStream(byteArrayInputStream);
        VulnRetuHub vulnRetuHub = (VulnRetuHub) ois.readObject();
//        System.out.println(vulnRetuHub);
//        for (Map.Entry<String, LinkedList<VulnRetu>> entry:vulnRetuHub.vulnMap.entrySet()){
//            System.out.println(entry.getKey());
//            for (VulnRetu vulnRetu:entry.getValue()) {
//                System.out.println(vulnRetu.getStmtInfos());
//            }
//            System.out.println(entry.getValue());
//        }
        return vulnRetuHub;
    }
}
